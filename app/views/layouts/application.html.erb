<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Cat Log Rails" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag "application", "data-turbo
    -track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>
  
  <body>
    <div class="drawer drawer-end"> <%# 1. 箱の開始 %>
      <input id="my-drawer-header" type="checkbox" class="drawer-toggle" />
      <div class="drawer-content" style="width: 100%; display: block;">

    <!-- ヘッダー -->
    <header style="padding: 10px; border-bottom: 1px solid #ccc; display:flex; justify-content: space-between; align-items:center;">
  <!-- 左側：タイトル -->
    <h1 class="site-title">
      <%= link_to root_path do %>
      <%= image_tag "logo.png", alt: "キャットlog", class: "site-logo" %>
    <% end %>
    </h1>

  <!-- 右側：ログイン / 投稿 / プロフィール / ログアウト -->
  <nav style="display:flex; align-items:center; gap:10px;">
    <% if user_signed_in? %>

    <label for="my-drawer-header" class="btn btn-ghost btn-square" style="display: inline-flex; align-items: center; justify-content: center; height: 40px; width: 40px; min-height: 0;">
      <span class="material-symbols-outlined" style="font-size: 30px;">menu</span>
    </label>

      <!-- ユーザー名表示 -->
      <span><%= current_user.login_name %></span>

  <!-- プロフィールアイコン -->
  <div style="margin-left:10px;">
    <% if current_user.profile&.avatar&.attached? && current_user.profile.avatar.persisted? %> #ログインしてるユーザーがプロフィールがあって、画像が選ばれていて、かつその画像がちゃんと保存済みの完成品である時だけ、画像を出す
      <%= link_to account_path do %>
        <%= image_tag url_for(current_user.profile.avatar), class: "header-profile-icon", style: "width:40px; height:40px; border-radius:50%;" %>
      <% end %>
    <% else %>
      <%= link_to account_path do %>
        <%= image_tag "default_cat_blue.png", class: "header-profile-icon", style: "width:40px; height:40px; border-radius:50%;" %>
      <% end %>
    <% end %>
  </div>

    <%= link_to "投稿する", new_post_path, class: "post-action" %>
    <%= button_to "ログアウト", destroy_user_session_path, method: :delete, class: "log-out-action" %>

    <% else %>
      <!-- ログイン / 新規登録 -->
      <%= link_to "ログイン", new_user_session_path, class: "header-link login-link"  %>
      <%= link_to "新規登録", new_user_registration_path,  class: "header-link signup-link" %>
      <!--ゲストログイン -->
      <%= button_to "ゲストログイン", guest_sign_in_path, method: :post, class: "btn-guest" %>
    <% end %>

  </nav>
</header>
  <%= render 'layouts/flash' %>
    <!-- ページごとのコンテンツ -->
    <main class="content">
      <%= yield %>
    </main>
  </div>

  <div class="drawer-side" style="z-index: 999;">
      <label for="my-drawer-header" aria-label="close sidebar" class="drawer-overlay"></label>
      <ul class="menu bg-base-200 min-h-full w-80 p-4">
        <li class="menu-title text-lg font-bold">メニュー</li>
        <li><%= link_to "トップページ", root_path %></li>
        <li><%= link_to "投稿一覧", posts_path %></li>
        <li><%= link_to "マイページ", account_path %></li>
        <li><%= link_to "新規投稿", new_post_path %></li>
        <li><%= button_to "ログアウト", destroy_user_session_path, method: :delete, class: "text-red-500" %></li>
      </ul>
    </div>
  </div> <%# 1. 箱の終了 %>
  
  </body>
</html>
