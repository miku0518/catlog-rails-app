<div class="post-detail-container">
  <%# 投稿メインカード %>
  <div class="post-main-card">
    <div class="post-header">
      <div class="post-meta">
        <span class="post-author">投稿者：<%= @post.user.login_name %></span>
        <span class="post-date"><%= @post.created_at.strftime("%Y/%-m/%-d %-H:%M") %></span>
      </div>
      <h1 class="post-title"><%= @post.title %></h1>
    </div>

    <div class="post-content">
      <% if @post.image.attached? %>
        <div class="post-image-wrapper">
          <%= image_tag @post.image, class: "post-main-image" %>
        </div>
      <% end %>
      
      <div class="post-body">
        <%= simple_format(@post.body) %>
      </div>
    </div>

    <% if @post.user == current_user %>
      <div class="post-show-action">
        <%= link_to "編集する", edit_post_path(@post), class: "btn-edit" %>
        <%= link_to "削除する", @post, data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" }, class: "btn-delete" %>
      </div>
    <% end %>
  </div>

  <%# コメントセクションの見出し %>
    <div class="comment-section">
      <div class="section-title">
        <div class="stat-group">
          <i class="fas fa-comments"></i>
          <span class="label">コメント</span>
          <span class="comment-count"><%= @post.comments.count %></span>
        </div>

      <%# いいね数表示（既存のクラスを使い回し） %>
      <div class="like-btn liked">
        <span class="material-symbols-outlined icon-filled">favorite</span>
        <span class="count-text"><%= @post.likes.count %></span>
      </div>
    </div>

    <%# コメント一覧 %>
    <div class="comments-list">
      <% @post.comments.each do |comment| %>
        <div class="comment-item">
          <div class="comment-info">
            <span class="comment-user"><%= comment.user.login_name %></span>
          </div>
          <div class="comment-body">
            <%= comment.body %>
          </div>
          <% if user_signed_in? && comment.user == current_user %>
            <div class="comment-delete-link">
              <%= link_to "削除する", post_comment_path(@post, comment), data: {turbo_method: :delete, turbo_confirm: "本当に削除しますか？"} %>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>

    <%# コメント投稿フォーム %>
    <div class="comment-form-wrapper">
      <% if user_signed_in? %>
        <%= form_with(model: [@post, Comment.new], local: true, class: "comment-form") do |f| %>
          <div class="form-group">
            <%= f.label :body, "コメントを投稿する", class: "form-label" %>
            <%= f.text_area :body, rows: 3, placeholder: "あたたかいコメントをお願いします", class: "form-input" %>
          </div>
          <div class="form-actions">
            <%= f.submit "投稿する", class: "btn-submit" %>
          </div>
        <% end %>
      <% else %>
        <div class="login-prompt">
          <p>コメントするには <%= link_to "ログイン", new_user_session_path %> が必要です。</p>
        </div>
      <% end %>
    </div>
  </div>

  <div class="back-link-wrapper">
    <%= link_to "← 一覧に戻る", posts_path, class: "back-link-post" %>
  </div>
</div>
