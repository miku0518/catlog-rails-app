<% if @post.image.attached? %>
  <%= image_tag @post.image, style: "max-width: 300px;" %>
<% end %>
<h1><%= @post.title %></h1>
<p><%= @post.body %></p>
<p>投稿者：<%= @post.user.login_name %></p>
<p>投稿日時: <%= @post.created_at.strftime("%Y-%m-%d %H:%M") %></p>

<% if @post.user == current_user %>
<%= link_to "編集する", edit_post_path(@post) %> |
<%= link_to "削除する", @post, data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" } %>
<% end %>


<!-- コメント数 -->
<h3>コメント <%= @post.comments.count %> </h3>

<!-- コメント一覧 -->
<% @post.comments.each do |comment| %>
  <div class="comment">
    <p>
      <strong><%= comment.user.login_name %>:</strong>
      <%= comment.body %>
    </p>
    <% if user_signed_in? && comment.user == current_user %>
      <%= link_to "削除する", post_comment_path(@post, comment), data: {turbo_method: :delete, turbo_confirm: "本当に削除しますか？"} %>
    <% end %>
  </div>
<% end %>



<!-- コメント投稿フォーム -->
<% if user_signed_in? %>
  <%= form_with(model: [@post, Comment.new], local: true) do |f| %>
    <p>
      <%= f.label :body, "コメント" %><br>
      <%= f.text_area :body, rows: 3 %>
    </p>
    <p>
      <%= f.submit "投稿" %>
    </p>
  <% end %>
<% else %>
  <p>コメントするには <%= link_to "ログイン", new_user_session_path %> が必要です。</p>
<% end %>

<hr>
<%= link_to "一覧に戻る", posts_path %>
