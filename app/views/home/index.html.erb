<div class="container">
  <div class="top-card">
    <span class="badge">～猫好きのコミュニティへようこそ～</span>
    <p class="text">
      キャットlogは猫好きのための掲示板アプリです。<br />
      あなたの愛猫のかわいい瞬間や、悩みを共有しましょう。
    </p>
  </div>
</div>

<p class="headline">最新の投稿</p>

<div class="post-list flex flex-wrap justify-center gap-6">
  <% @posts.each do |post| %>
    <div class="card bg-white shadow-md rounded-lg overflow-hidden w-80">
      
      <div class="post-image-wrapper">
        <% if post.image.attached? %>
          <%= image_tag post.image, class: "post-image", alt: post.title %>
        <% else %>
          <%= image_tag "no_image.png", class: "post-image", alt: "No image" %>
        <% end %>
      </div>

      <div class="card-body p-4">
        <div class="card-title font-bold text-lg mb-1">
          <%= link_to truncate(post.title, length: 15, omission: '...'), post_path(post), class: "hover:text-blue-500" %>
        </div>
        
        <p class="text-sm text-gray-500">投稿者：<%= post.user.login_name %></p>

        <div class="flex items-center justify-end gap-6 my-3 border-b border-gray-100 pb-2">
          
          <div class="flex items-center text-gray-600">
            <span class="material-symbols-outlined" style="font-size:18px; margin-right:4px;">chat_bubble</span>
            <span style="font-size: 14px;"><%= post.comments.count %></span>
          </div>

          <%= turbo_frame_tag dom_id(post, :like) do %>
            <div class="like-section">
              <% if user_signed_in? %>
                <%# URLヘルパーを配列形式 [post, :like] にするとエラーが起きにくいです %>
                <%= link_to [post, :like], data: { turbo_method: (post.liked_by?(current_user) ? :delete : :post) }, 
                            class: "like-btn #{'liked' if post.liked_by?(current_user)}" do %>
                  <span class="material-symbols-outlined icon-small">favorite</span>
                  <span class="count-text"><%= post.likes.count %></span>
                <% end %>
              <% else %>
                <div class="like-btn disabled">
                  <span class="material-symbols-outlined icon-small">favorite</span>
                  <span class="count-text"><%= post.likes.count %></span>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>

        <p class="text-xs text-gray-400 mb-3"><%= post.created_at.strftime("%Y/%-m/%-d %-H:%M") %></p>
        
        <div class="card-actions flex justify-end">
          <%= link_to "続きを読む", post_path(post), class: "btn btn-outline btn-info btn-sm" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="pagination-wrapper">
  <%= paginate @posts %>
</div>